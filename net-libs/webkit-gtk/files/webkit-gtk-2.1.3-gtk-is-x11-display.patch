source: https://bug-117895-attachments.webkit.org/attachment.cgi?id=206413&action=diff&format=raw&headers=1
bug report:https://bugs.webkit.org/show_bug.cgi?id=117895
author:  Dominique Leuenberger

--

--- Source/WebCore/ChangeLog	(revision 152495)
+++ Source/WebCore/ChangeLog	(working copy)
@@ -1,3 +1,19 @@ 
+2013-07-09  Dominique Leuenberger  <dimstar@opensuse.org>
+
+        Fix build against GTK+ 2.0
+        https://bugs.webkit.org/show_bug.cgi?id=117895
+
+        Reviewed by NOBODY (OOPS!).
+
+        GTK2 build fails for undefined GDK_IS_X11_DISPLAY
+        GTK 2.0 does define GDK_WINDOWING_X11,but GDK_IS_X11_DISPLAY is not
+        present in GTK+ 2.0. A dummy defines is sufficient, as GTK 2.0 is not
+        that multiple backend aware anyway...
+
+        * platform/gtk/GtkVersioning.h: Define GDK_IS_X11_DISPLAY for GTK+ 2.0
+          and compatibility for gtk_widget_get_preferred_size()
+        * plugins/gtk/gtk2xtbin.c: Include config.h
+
 2013-07-09  peavo@outlook.com  <peavo@outlook.com>
 
         [Windows] Compile fix.
--- Source/WebCore/platform/gtk/GtkVersioning.h	(revision 152495)
+++ Source/WebCore/platform/gtk/GtkVersioning.h	(working copy)
@@ -40,6 +40,21 @@ 
 
 GdkDevice* getDefaultGDKPointerDevice(GdkWindow* window);
 
+// gtk_widget_get_preferred_size() appeared only in GTK 3.0.
+#if !GTK_CHECK_VERSION (2, 91, 0)  // gtk_widget_get_preferred_size appeared about then.
+#define gtk_widget_get_preferred_size(widget, minimumSize, naturalSize) \
+        (gtk_widget_size_request((widget), ((minimumSize))))
+#endif
+
+// Define GDK_IS_X11_DISPLAY dummy for GTK+ 2.0 compatibility.
+#ifndef GDK_IS_X11_DISPLAY
+  #ifdef GDK_WINDOWING_X11
+    #define GDK_IS_X11_DISPLAY(display) 1
+  #else
+    #define GDK_IS_X11_DISPLAY(display) 0
+  #endif
+#endif
+
 G_END_DECLS
 
 #endif // GtkVersioning_h
--- Source/WebCore/plugins/gtk/gtk2xtbin.c	(revision 152495)
+++ Source/WebCore/plugins/gtk/gtk2xtbin.c	(working copy)
@@ -42,6 +42,7 @@ 
  * inside a GTK application.  
  */
 
+#include "config.h"
 #include "GtkVersioning.h"
 #include "xembed.h"
 #include "gtk2xtbin.h"

