diff -ur firefox-49.0.orig/media/ffvpx/libavcodec/x86/h264_i386.h firefox-49.0/media/ffvpx/libavcodec/x86/h264_i386.h
--- firefox-49.0.orig/media/ffvpx/libavcodec/x86/h264_i386.h	2016-05-12 10:13:15.000000000 -0700
+++ firefox-49.0/media/ffvpx/libavcodec/x86/h264_i386.h	2016-10-02 19:25:49.751438980 -0700
@@ -48,12 +48,12 @@
 #define decode_significance decode_significance_x86
 static int decode_significance_x86(CABACContext *c, int max_coeff,
                                    uint8_t *significant_coeff_ctx_base,
-                                   int *index, x86_reg last_off){
+                                   int *index, intptr_t last_off){
     void *end= significant_coeff_ctx_base + max_coeff - 1;
     int minusstart= -(intptr_t)significant_coeff_ctx_base;
     int minusindex= 4-(intptr_t)index;
     int bit;
-    x86_reg coeff_count;
+    intptr_t coeff_count;
 
 #ifdef BROKEN_RELOCATIONS
     void *tables;
@@ -68,8 +68,8 @@
     __asm__ volatile(
         "3:                                     \n\t"
 
-        BRANCHLESS_GET_CABAC("%4", "%q4", "(%1)", "%3", "%w3",
-                             "%5", "%q5", "%k0", "%b0",
+        BRANCHLESS_GET_CABAC("%4", "%"REG_PTR_MOD"4", "(%1)", "%3", "%w3",
+                             "%5", "%"REG_PTR_MOD"5", "%k0", "%b0",
                              "%c11(%6)", "%c12(%6)",
                              AV_STRINGIFY(H264_NORM_SHIFT_OFFSET),
                              AV_STRINGIFY(H264_LPS_RANGE_OFFSET),
@@ -80,8 +80,8 @@
         " jz 4f                                 \n\t"
         "add  %10, %1                           \n\t"
 
-        BRANCHLESS_GET_CABAC("%4", "%q4", "(%1)", "%3", "%w3",
-                             "%5", "%q5", "%k0", "%b0",
+        BRANCHLESS_GET_CABAC("%4", "%"REG_PTR_MOD"4", "(%1)", "%3", "%w3",
+                             "%5", "%"REG_PTR_MOD"5", "%k0", "%b0",
                              "%c11(%6)", "%c12(%6)",
                              AV_STRINGIFY(H264_NORM_SHIFT_OFFSET),
                              AV_STRINGIFY(H264_LPS_RANGE_OFFSET),
@@ -127,9 +127,9 @@
                                        int *index, uint8_t *last_coeff_ctx_base, const uint8_t *sig_off){
     int minusindex= 4-(intptr_t)index;
     int bit;
-    x86_reg coeff_count;
-    x86_reg last=0;
-    x86_reg state;
+    intptr_t coeff_count;
+    intptr_t last=0;
+    intptr_t state;
 
 #ifdef BROKEN_RELOCATIONS
     void *tables;
@@ -149,8 +149,8 @@
         "movzb (%0, %6), %6                     \n\t"
         "add %9, %6                             \n\t"
 
-        BRANCHLESS_GET_CABAC("%4", "%q4", "(%6)", "%3", "%w3",
-                             "%5", "%q5", "%k0", "%b0",
+        BRANCHLESS_GET_CABAC("%4", "%"REG_PTR_MOD"4", "(%6)", "%3", "%w3",
+                             "%5", "%"REG_PTR_MOD"5", "%k0", "%b0",
                              "%c12(%7)", "%c13(%7)",
                              AV_STRINGIFY(H264_NORM_SHIFT_OFFSET),
                              AV_STRINGIFY(H264_LPS_RANGE_OFFSET),
@@ -162,14 +162,14 @@
         " jz 4f                                 \n\t"
 
 #ifdef BROKEN_RELOCATIONS
-        "movzb %c14(%15, %q6), %6\n\t"
+        "movzb %c14(%15, %"REG_PTR_MOD"6), %6\n\t"
 #else
         "movzb "MANGLE(ff_h264_cabac_tables)"+%c14(%6), %6\n\t"
 #endif
         "add %11, %6                            \n\t"
 
-        BRANCHLESS_GET_CABAC("%4", "%q4", "(%6)", "%3", "%w3",
-                             "%5", "%q5", "%k0", "%b0",
+        BRANCHLESS_GET_CABAC("%4", "%"REG_PTR_MOD"4", "(%6)", "%3", "%w3",
+                             "%5", "%"REG_PTR_MOD"5", "%k0", "%b0",
                              "%c12(%7)", "%c13(%7)",
                              AV_STRINGIFY(H264_NORM_SHIFT_OFFSET),
                              AV_STRINGIFY(H264_LPS_RANGE_OFFSET),
diff -ur firefox-49.0.orig/media/ffvpx/libavutil/x86/asm.h firefox-49.0/media/ffvpx/libavutil/x86/asm.h
--- firefox-49.0.orig/media/ffvpx/libavutil/x86/asm.h	2016-05-12 10:13:15.000000000 -0700
+++ firefox-49.0/media/ffvpx/libavutil/x86/asm.h	2016-10-02 19:21:55.475427235 -0700
@@ -27,8 +27,9 @@
 typedef struct xmm_reg { uint64_t a, b; } xmm_reg;
 typedef struct ymm_reg { uint64_t a, b, c, d; } ymm_reg;
 
-#if ARCH_X86_64
+#if ARCH_X86_64 && !defined(__ILP32__)
 #    define OPSIZE "q"
+#    define REG_PTR_MOD "q"
 #    define REG_a "rax"
 #    define REG_b "rbx"
 #    define REG_c "rcx"
@@ -47,16 +48,19 @@
 #    define REGc    rcx
 #    define REGd    rdx
 #    define REGSP   rsp
+#    define REG8    r8
 
-#elif ARCH_X86_32
+#elif ARCH_X86_32 || (defined(__x86_64__) && defined(__ILP32__))
 
 #    define OPSIZE "l"
+#    define REG_PTR_MOD "k"
 #    define REG_a "eax"
 #    define REG_b "ebx"
 #    define REG_c "ecx"
 #    define REG_d "edx"
 #    define REG_D "edi"
 #    define REG_S "esi"
+#    define REG_8 "r8d"
 #    define PTR_SIZE "4"
 typedef int32_t x86_reg;
 
@@ -68,10 +72,31 @@
 #    define REGc    ecx
 #    define REGd    edx
 #    define REGSP   esp
+#    define REG8    r8d
 #else
 typedef int x86_reg;
 #endif
 
+#if ARCH_X86_64 && !defined(__ILP32__)
+#    define REG_ra "rax"
+#    define REG_rb "rbx"
+#    define REG_rc "rcx"
+#    define REG_rd "rdx"
+#    define REG_rD "rdi"
+#    define REG_rS "rsi"
+#    define REG_rBP "rbp"
+typedef int64_t x86_native_reg;
+#elif ARCH_X86_32 || (defined(__x86_64__) && defined(__ILP32__))
+#    define REG_ra "eax"
+#    define REG_rb "ebx"
+#    define REG_rc "ecx"
+#    define REG_rd "edx"
+#    define REG_rD "edi"
+#    define REG_rS "esi"
+#    define REG_rBP "ebp"
+typedef int32_t x86_native_reg;
+#endif
+
 #define HAVE_7REGS (ARCH_X86_64 || (HAVE_EBX_AVAILABLE && HAVE_EBP_AVAILABLE))
 #define HAVE_6REGS (ARCH_X86_64 || (HAVE_EBX_AVAILABLE || HAVE_EBP_AVAILABLE))
 
diff -ur firefox-49.0.orig/media/ffvpx/libavutil/x86/cpu.c firefox-49.0/media/ffvpx/libavutil/x86/cpu.c
--- firefox-49.0.orig/media/ffvpx/libavutil/x86/cpu.c	2016-05-31 21:11:43.000000000 -0700
+++ firefox-49.0/media/ffvpx/libavutil/x86/cpu.c	2016-10-02 19:31:29.765456026 -0700
@@ -41,9 +41,9 @@
 /* ebx saving is necessary for PIC. gcc seems unable to see it alone */
 #define cpuid(index, eax, ebx, ecx, edx)                        \
     __asm__ volatile (                                          \
-        "mov    %%"REG_b", %%"REG_S" \n\t"                      \
+        "mov    %%"REG_rb", %%"REG_rS" \n\t"                      \
         "cpuid                       \n\t"                      \
-        "xchg   %%"REG_b", %%"REG_S                             \
+        "xchg   %%"REG_rb", %%"REG_rS                             \
         : "=a" (eax), "=S" (ebx), "=c" (ecx), "=d" (edx)        \
         : "0" (index), "2"(0))
 
