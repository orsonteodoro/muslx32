--- gdb-7.5.1.orig/gdb/common/linux-ptrace.c	2012-09-17 11:28:14.000000000 -0700
+++ gdb-7.5.1/gdb/common/linux-ptrace.c	2016-06-24 16:37:28.221343794 -0700
@@ -110,11 +110,11 @@
 			"ret"
 			: : "r" (return_address) : "%esp", "memory");
 #elif defined __x86_64__
-	  asm volatile ("pushq %0;"
+	  asm volatile ("push %0;"
 			".globl linux_ptrace_test_ret_to_nx_instr;"
 			"linux_ptrace_test_ret_to_nx_instr:"
 			"ret"
-			: : "r" (return_address) : "%rsp", "memory");
+			: : "r" ((uint64_t) (uintptr_t) return_address) : "sp", "memory");
 #else
 # error "!__i386__ && !__x86_64__"
 #endif
